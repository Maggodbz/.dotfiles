;; ~/.config/eww/topbar/eww.yuck

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; VARIABLES â€“ nothing here should error now
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;; Workspaces: bracket the active one
(defpoll WORKSPACES :interval "1s"
  "bash -lc 'hyprctl workspaces -j \
     | jq -r \"[.[] | select(.focused) | .id] as $cur \
               | .[] | (if .id == $cur then \"[\" + (.id|tostring) + \"]\" else .id|tostring end)\" \
     | paste -sd \" \" -'")

;; Hyperâ€mode (just passthrough your existing script)
(defpoll HYPER :interval "1s"
  "~/.config/waybar/modules/hyper-mode-status.sh")

;; VPN status (ðŸ”’ or ðŸ”“)
(defpoll VPN :interval "5s"
  "~/.config/waybar/modules/enliteai-vpn-status.sh")

;; Clock + tooltip
(defpoll TIME :interval "1s"  "date +\"%H:%M\"")
(defpoll TIME_TT :interval "1s" "date +\"%Y-%m-%d | Week %V | %H:%M:%S\"")

;; Volume
(defpoll VOL :interval "1s"
  "bash -lc 'pactl get-sink-volume @DEFAULT_SINK@ \
     | awk \"NR==1 {print \\$5}\"'")

;; Backlight
(defpoll BRT :interval "1s"
  "bash -lc 'brightnessctl get | awk \"NR==1 {printf \\\"%d%%\\\", \\$1}\"'")

;; Battery
(defpoll BAT :interval "10s"
  "bash -lc 'cat /sys/class/power_supply/BAT0/capacity \
     | awk \"{printf \\\"%d%%\\\", \\$1}\"'")

;; Network SSID (or "â€“" if none)
(defpoll NET :interval "5s"
  "bash -lc 'nmcli -t -f NAME,STATE connection show --active \
     | grep activated | cut -d: -f1 || echo â€“'")

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; WIDGET: the bar itself
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defwidget topbar []
  (box
    :orientation "h"
    :class       "topbar"
    :hexpand     "true"
    :spacing     2

    ;; â”€ left: workspaces
    (box :orientation "h" :class "left" :spacing 2
      (label :text WORKSPACES))

    ;; â”€ center: hyper
    (box :orientation "h" :class "center" :spacing 2
      (button
        :onclick "bash -lc 'echo hyper > ~/.config/hypr/mode && hyprctl dispatch submap hyper'"
        (label :text HYPER)))
    ))
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; WINDOW: make it a proper dock at the top
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(defwindow topbar
  :monitor    "DP-5"
  :geometry   (geometry :x "0px" :y "0px" :width "100%" :height "24px" :anchor "top center")
  :exclusive  true
  :namespace  "eww-topbar"
  :windowtype "dock"
  :wm-ignore  false
  (topbar))
